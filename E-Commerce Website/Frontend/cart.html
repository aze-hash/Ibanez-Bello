<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cart - ShopLife</title>
  <link href="https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="shop.css" />
  <link rel="stylesheet" href="cart.css" />
</head>

<body>
  <!-- === Header === -->
  <header class="shop-header">
    <div class="nav container d-flex">
      <div class="logo"><h1>ShopLife</h1></div>
      <ul class="shop-nav d-flex">
        <li><a href="shop.html"><i class='bx bx-store'></i> Home</a></li>
        <li><a href="favorites.html" class="nav-link"><i class='bx bx-heart'></i> Favorites</a></li>
        <li><a href="profile.html" class="nav-link"><i class='bx bx-user'></i> Profile</a></li>
      </ul>
    </div>
  </header>

  <!-- === Cart Section === -->
  <section class="cart container">
    <h2>Your Shopping Cart</h2>
    <div class="cart-items"></div>
    <h3 id="total">Total: ₱0</h3>
    <button class="btn checkout-btn">Proceed to Checkout</button>
  </section>

  <script>
    const cartContainer = document.querySelector('.cart-items');
    const totalDisplay = document.getElementById('total');
    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    // Ensure each item has a quantity
    cart = cart.map(item => ({
      ...item,
      quantity: item.quantity || 1
    }));

    function renderCart() {
      cartContainer.innerHTML = '';
      let total = 0;

      if (cart.length === 0) {
        cartContainer.innerHTML = "<p class='empty-cart'>Your cart is empty.</p>";
        totalDisplay.innerText = "Total: ₱0";
        return;
      }

      cart.forEach((item, index) => {
        const priceValue = parseFloat(item.price.replace(/[₱,]/g, '')) || 0;
        const quantity = item.quantity || 1;
        const subtotal = priceValue * quantity;
        total += subtotal;

        const div = document.createElement('div');
        div.classList.add('cart-item');
        div.innerHTML = `
          <img src="${item.image}" alt="${item.name}">
          <div class="cart-info">
            <h4>${item.name}</h4>
            <p class="price">Price: ₱${priceValue.toLocaleString()}</p>
            
            <div class="quantity-controls">
              <button class="qty-btn decrease">−</button>
              <span class="quantity">${quantity}</span>
              <button class="qty-btn increase">+</button>
            </div>
            
            <p class="subtotal">Subtotal: ₱${subtotal.toLocaleString()}</p>
            <button class="remove-btn"><i class='bx bx-trash'></i> Remove</button>
          </div>
        `;

        // Decrease quantity
        div.querySelector('.decrease').addEventListener('click', () => {
          if (cart[index].quantity > 1) {
            cart[index].quantity--;
            saveCart();
            renderCart();
          }
        });

        // Increase quantity
        div.querySelector('.increase').addEventListener('click', () => {
          cart[index].quantity++;
          saveCart();
          renderCart();
        });

        // Remove item
        div.querySelector('.remove-btn').addEventListener('click', () => {
          cart.splice(index, 1);
          saveCart();
          renderCart();
        });

        cartContainer.appendChild(div);
      });

      totalDisplay.innerText = `Total: ₱${total.toLocaleString()}`;
    }

    function saveCart() {
      localStorage.setItem('cart', JSON.stringify(cart));
    }

    // Initial render
    renderCart();

    // Checkout button
    document.querySelector('.checkout-btn').addEventListener('click', () => {
      if (cart.length === 0) {
        alert('Your cart is empty!');
      } else {
        alert('Proceeding to checkout...');
        window.location.href = 'checkout.html';
      }
    });
  </script>
</body>
</html>
